function [sCal,Te2h] = handeye2()
% 5月11号数据 亲测可用
% 手眼数据
eye0 = [ -19.954, 100.099, -777;
    -1.35, 116.20, -783;
    15.817, 222.04, -770.49;
    -38.61, 173.27, -751;
    -58.14, 247.54, -727.72;
    -187.44,221.47, -657.27;
    -132.13, 272.31, -680.11;
    -8.41, 169.89, -768.67;
    -101.91,269.98,-699.43;
    -82.12, 195.24,-725.2;
    -14.43,224.6,-759.29;
    
    55.29, 50.99, -739.39 ;
    3.833, 94.76, -760.15;
    28.00, 141.45, -775.25;
    2.13, 164.33, -786.06;
    -73.9, 181.11, -797.54;
    -149.68, 180.09, -800.07;
    -199.51, 201.46, -810.04;
    -197.91, 133.15, - 784.79;
    -196.73, 84.27, -764.14;
    -121.53, 65.95, -755.68];
eye = ones(size(eye0,1),4);
eye(:,1:3) = eye0;
hand0 = [554.43, 86.56, 26.40;
    489.88, 23.94, 26.33;
    428.02, 46.78, 93.24;
    488.03, 108.70, 93.51;
    422.03, 133.04, 157.41;
    486.54, 281.48, 223.32;
    420.96, 217.70, 223.51;
    523.68, 114.07, 71.43;
    414.97, 183.44, 201.08;
    480.34, 156.75, 138.08;
    431.51, 79.24, 116.40;
    
    620.79, -3.84 46.34;
    564.93, 57.48, 43.21;
    502.63, 31.65, 43.08;
    474.43, 61.73, 41.53;
    448.98, 152.99, 36.18;
    454.66, 240.95, 30.84;
    426.16, 303.27, 27.10;
    516.39, 298.60, 28.26;
    576.75, 296.611, 26.55;
    601.57, 206.31, 33.23];
hand = ones(size(hand0,1),4);
hand(:,1:3) = hand0;
% hand 所有点到第一个点的距离
for i = 1:size(hand,1)
    dh(i) = norm(hand(i,:)-hand(1,:));
end
% eye 所有点到第一个点的距离
for i = 1:size(eye,1)
    de(i) = norm(eye(i,:)-eye(1,:));
end
% 距离比值，也就是缩放比例
sCal = mean(dh(2:end)./de(2:end));
% eye 乘以缩放系数
eye(:,1:3) = eye(:,1:3)*sCal;

% 用最小二乘求解Te2h
lb = [-1.001,-1.001,-1.001,-2000];
ub = [1.001,1.001,1.001,2000];
options = optimoptions(@lsqlin,'Algorithm','interior-point','Display','iter');
r1 = lsqlin(eye,hand(:,1),[],[],[],[],lb,ub,[0.1 0.1 0.1 1]);
r2 = lsqlin(eye,hand(:,2),[],[],[],[],lb,ub,[0.1 0.1 0.1 1]);
r3 = lsqlin(eye,hand(:,3),[],[],[],[],lb,ub,[0.1 0.1 0.1 1]);

Te2h = [r1';r2';r3';0,0,0,1];
disp('calibration done')

% 误差分析
Htest = Te2h*eye';
Err = mean(mean(abs((Htest(1:3,:) - hand(:,1:3)')./hand(:,1:3)'*100)))
ErrM = Htest(1:3,:) - hand(:,1:3)';
% plot3(hand(:,1),hand(:,2),hand(:,3),'bx'); hold on
% plot3(Htest(1,:),Htest(2,:),Htest(3,:),'rx'); hold off
% plot3(eye(:,1),eye(:,2),eye(:,3),'bx');
% xlabel('x');ylabel('y');zlabel('z')